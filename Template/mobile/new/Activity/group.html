<!DOCTYPE html >
<html>
<head>
	<meta name="Generator" content="tpshop" />
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>{$goods.goods_name}_{$tpshop_config.shop_info_store_title}</title>
	<meta http-equiv="keywords" content="{$tpshop_config['shop_info_store_keyword']}" />
	<meta name="description" content="{$tpshop_config['shop_info_store_desc']}" />
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/public.css"/>
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/goods.css"/>
	<link rel="stylesheet" type="text/css" href="__STATIC__/css/layer.css"/>
	<link rel="stylesheet" type="text/css" href="__STATIC__/font/iconfont.css"/>
	<script type="text/javascript" src="__STATIC__/js/jquery.js"></script>
	<script type="text/javascript" src="__STATIC__/js/jquery.json.js"></script>
	<script type="text/javascript" src="__STATIC__/js/touchslider.dev.js"></script>
	<script type="text/javascript" src="__STATIC__/js/layer.js" ></script>
	<script src="__PUBLIC__/js/global.js"></script>
	<script src="__PUBLIC__/js/mobile_common.js"></script>
	<script src="__STATIC__/js/common.js"></script>
	<link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.0.1/weui.min.css">
	<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>

	<style>
		.pingtuan-wrapper{
			display: flex;
			line-height: 1;
			height: 100%;
			align-items: center;
			justify-content: space-between;
		}
		.pingtuan-wrapper .pingtuan-wrapper-flex {
			display: flex;
		}

		.pingtuan-wrapper .pingtuan-wrapper-flex .y-price {
			font-size: 24px;
			margin-right: 5px;
		}
		.pingtuan-wrapper .pingtuan-wrapper-flex .y-price i{
			font-size: 14px;
			padding-right: 3px;
		}
		.pingtuan-wrapper .pingtuan-wrapper-flex .p-price-wrapper{
			display: flex;
			flex-direction: column;
		}
		.pingtuan-wrapper .pingtuan-wrapper-flex .p-price-wrapper span:nth-child(2){
			margin-top: 2px;
			text-decoration: line-through;
		}
		.pingtuan-wrapper .al-ping-num {
			padding-right: 10px;
		}
		.ping-btn-wrapper .ping-btn:nth-child(2) {
			background: #ff8000;
		}
		.ping-btn-wrapper .ping-btn{
			width: 50%;
			color: white;
			line-height: 1;
			height: 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
		}
		.ping-btn-wrapper .ping-btn span:nth-child(1) {
			font-size: 16px;
		}
		.ping-btn-wrapper .ping-btn span:nth-child(2) {
			margin-top: 2px;
			font-size: 14px;
		}
	</style>
</head>
<body>
<script type="text/javascript">
	var process_request = "正在处理您的请求...";

	var Tday = new Array();
	var daysms = 24 * 60 * 60 * 1000
	var hoursms = 60 * 60 * 1000
	var Secondms = 60 * 1000
	var microsecond = 1000
	var DifferHour = -1
	var DifferMinute = -1
	var DifferSecond = -1

	function clock11(key)
	{
		var time = new Date()
		var hour = time.getHours()
		var minute = time.getMinutes()
		var second = time.getSeconds()
		var timevalue = ""+((hour > 12) ? hour-12:hour)
		timevalue +=((minute < 10) ? ":0":":")+minute
		timevalue +=((second < 10) ? ":0":":")+second
		timevalue +=((hour >12 ) ? " PM":" AM")
		var convertHour = DifferHour
		var convertMinute = DifferMinute
		var convertSecond = DifferSecond
		var Diffms = Tday[key].getTime() - time.getTime()
		DifferHour = Math.floor(Diffms / daysms)
		Diffms -= DifferHour * daysms
		DifferMinute = Math.floor(Diffms / hoursms)
		Diffms -= DifferMinute * hoursms
		DifferSecond = Math.floor(Diffms / Secondms)
		Diffms -= DifferSecond * Secondms
		var dSecs = Math.floor(Diffms / microsecond)

		if(convertHour != DifferHour) e="<span class=hour>"+DifferHour+"</span>天";
		if(convertMinute != DifferMinute) f="<span class=min>"+DifferMinute+"</span>时";
		if(convertSecond != DifferSecond) g="<span class=sec>"+DifferSecond+"</span>分";
		h="<span class=msec>"+dSecs+"</span>秒";
		if (DifferHour>0) {e=e}
		else {e=''}
		document.getElementById("jstimerBox"+key).innerHTML = e + f + g + h;
	}

</script>
<div class="main">
	<div class="tab_nav">
		<div class="header">
			<div class="h-left"><a class="sb-back" href="javascript:history.back(-1)" title="返回"></a></div>
			<div class="h-mid">
				<ul>
					<li><a href="javascript:;" class="tab_head on"   id="goods_ka1" onClick="setGoodsTab('goods_ka',1,3)">商品</a></li>
					<li><a href="javascript:;" class="tab_head" id="goods_ka2" onClick="setGoodsTab('goods_ka',2,3)">详情</a></li>
					<li><a href="javascript:;" class="tab_head" id="goods_ka3" onClick="setGoodsTab('goods_ka',3,3)">评价</a></li>
				</ul>
			</div>
			<div class="h-right">
				<aside class="top_bar">
					<div onClick="show_menu();$('#close_btn').addClass('hid');" id="show_more"><a href="javascript:;"></a> </div>
				</aside>
			</div>
		</div>
	</div>
	<include file="Public/menu"/>
	<div class="main" id="user_goods_ka_1" style="display:block;">
		<div class="banner">
			<style>
				.float-top {
					position: inherit;
					background: gray;
					opacity: 0.6;
				}

				.groupbuy-invite {
					text-align: center;
					line-height: 30px;
				}
				.groupbuy-invite-user {
					color: #ff8000;
				}
			</style>

			<div id="slider" class="slider" style="overflow: hidden; visibility: visible; list-style: none; position: relative;">
				<if condition="$group_order">
					<div class="timerBox float-top" style="box-sizing: border-box;">
						<div class="pingtuan-wrapper">
							<div class="pingtuan-wrapper-flex">
								<div class="y-price">
									<img src="{$group_order['user']['head_pic']|default=" __STATIC__/images/user68.jpg"}" width="30px" height="30px">
								</div>
								<span class="groupbuy-invite">
									<span class="groupbuy-invite-user">{$group_order['user']['nickname']}</span>
									发起的拼团
								</span>
							</div>
							<span class="al-ping-num">
								已参团：{$group_order[grouped_num]} / 成团人数：{$group_order[group_num]}
							</span>
						</div>
					</div>
				</if>

				<ul id="sliderlist" class="sliderlist" style="position: relative; overflow: hidden; transition: left 600ms ease; -webkit-transition: left 600ms ease;">
					<foreach  name="goods_images_list" item="pic">
						<li style="float: left; display: block; width: 100%;"><span><a  href="javascript:void(0)">
      	<img title="" width="100%" src="{$pic.image_url}"></a></span></li>
					</foreach>
				</ul>
				<div id="pagenavi">
					<foreach  name="goods_images_list" item="pic" key="k">
						<a href="javascript:void(0);" <if condition="$k eq 0">class="active"</if>></a>
					</foreach>
				</div>
				<!--<div class="timerBox">-->
				<!--<div class="clearfix pingtuan-wrapper">-->
				<!--<dfn class="f14">¥</dfn>-->
				<!--<span class="f24" style="margin-right:8px;">{$goods.shop_price}</span><del class="op8">¥</del><del class="op8">{$goods.market_price}</del>-->
				<!--&lt;!&ndash;<i class="i_tjms i_icon" ></i>&ndash;&gt;-->
				<!--<span>-->
				<!--<i>2</i>-->
				<!--<i>人团</i>-->
				<!--</span>-->
				<!--</div>-->
				<!--</div>-->
				<div class="timerBox" style="box-sizing: border-box;">
					<div class="pingtuan-wrapper">
						<div class="pingtuan-wrapper-flex">
							<div class="y-price"><i style="vertical-align: middle;">¥</i>{$group_buy_info.price}</div>
							<div class="p-price-wrapper">
								<span class="p-dict-price">拼团优惠价</span>
								<span>¥{$group_buy_info['goods_price']}</span>
							</div>
						</div>
						<span class="al-ping-num">{$group_buy_info['group_num']}人团</span>
					</div>
				</div>
			</div>
		</div>
		<div class="s_bottom"></div>
		<script type="text/javascript">$(function(){
			$("div.module_special .wrap .major ul.list li:last-child").addClass("remove_bottom_line");
		});
		var active=0,
				as=document.getElementById('pagenavi').getElementsByTagName('a');

		for(var i=0;i<as.length;i++){
			(function(){
				var j=i;
				as[i].onclick=function(){
					t2.slide(j);
					return false;
				}
			})();
		}
		var t2=new TouchSlider({id:'sliderlist', speed:600, timeout:6000, before:function(index){
				as[active].className='';
				active=index;
				as[active].className='active';
			}});
		</script>
		<form name="buy_goods_form" method="post" id="buy_goods_form" >
			<div class="product_info">
				<div class="info_dottm">
					<h3 class="name">{$goods.goods_name}</h3>
				</div>
				<div class="timer-wrapper">
					<span class="des">限量购买 每个ID限量 {$group_buy_info['buy_limit']} 件</span>
				</div>
				<if condition="$group_order">
					<div class="timer-wrapper">
					<span class="des">成团倒计时:
                        <if condition="$group_order[group_status] eq 2">
                            <span class="sg_g_time last_g_time" style="color: red;">此拼团已失效</span>
                        <else />
                         	<span class="sg_g_time last_g_time" id="jstimerBox{$group_order[goods_id]}" style="color: red;"></span>
                            <script>
							Tday['{$group_order[goods_id]}'] = new Date('{$group_order[close_at]|date="Y/m/d H:i:s",###}');
                            window.setInterval(function()
                            {clock11('{$group_order[goods_id]}');}, 1000);
						</script>
                        </if>
					</span>

					</div>
				</if>


				<ul class="price_dottm">
					<li style=" text-align:left">折扣：{$group_buy_info.rebate}折</li>
					<li>{$commentStatistics.c0}人评价</li>
					<li style=" text-align:right">{$group_buy_info[virtual_num] + $group_buy_info[buy_num]}人已参团</li>
				</ul>
			</div>
			<section id="search_ka" class="huodong">
				<div class="subNav">
					<div class="att_title"> <span>惠</span>
						<p>拼团活动</p>
					</div>
				</div>
				<div class="navContent">
					<ul class="youhui_list1">
						<li>
							<a href="javascript:void(0);" title="{$group_buy_info[name]}"><img src="__STATIC__/images/hui.png"></a>
							<a href="javascript:void(0);" >{$group_buy_info[name]}&nbsp;&nbsp;(活动时间：{$group_buy_info[start_time]|date="Y年m月d日",###} - {$group_buy_info[end_time]|date="Y年m月d日",###})</a>
						</li>
					</ul>
					<div class="blank10"></div>
				</div>
			</section>

			<div style="height: 8px;background: #eeeeee;"></div>
			<div class="subNavBox">
				<div class="subNav on"><strong>适用门店</strong></div>
				<ul class="navContent" style="display: block;">
					<div class="shop-list">
						<foreach name="shops" item="shop">
							<div class="shop-item">
								<a href="{:U('Map/byStore', ['shop_id' => $shop[id]])}"><span class="shop-location-img"><i class=" icon icon-dingwei1"></i></span></a>
								<div class="shop-des">
									<span class="shop-name">{$shop.title}</span>
									<p class="shop-address">{:getShopPosition($shop)}</p>
								</div>
								<span class="shop-phone"><i class=" icon icon-tel_phone"></i></span>
							</div>
						</foreach>
					</div>
				</ul>
			</div>
			<div style="height: 8px;background: #eeeeee;"></div>
			<div class="recommend-shops">
				<div class="recommend-tips">
					<span class="text">附近在售爆品</span>
				</div>
				<div class="recommend-list">
					<foreach name="nearbyGoods" item="nearby">
						<div class="recommend-item">
							<a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$nearby[goods_id]))}" title="{$nearby.goods_name}">
								<img src="{$nearby.goods_id|goods_thum_images=400,400}" alt="">
								<div class="desc">{$nearby.goods_name}</div>
								<span class="price">¥{$nearby.shop_price}</span>
							</a>
						</div>
					</foreach>
				</div>
			</div>
			<script type="text/javascript">
				$(function(){
					$(".subNav").click(function(){
						$(this).next(".navContent").slideToggle(300).siblings(".navContent").slideUp(500);
						$(this).toggleClass("on").siblings(".subNav").removeClass("on");
						if($(".is_scroll").length <= 0)
						{
							$('html,body').animate({'scrollTop':$('body')[0].scrollHeight},600);
						}
					});
					commentType = 1; // 评论类型
					ajaxComment(1,1);// ajax 加载评价列表
				})
			</script>
			<script type="text/jscript">
function click_search (){
  var search_ka = document.getElementById("search_ka");
  	if (search_ka.className == "s-buy open ui-section-box"){
	  	search_ka.className = "s-buy ui-section-box";
	}else {
		search_ka.className = "s-buy open ui-section-box";
	}
}

function changeAtt(t) {
	t.lastChild.checked='checked';
	for (var i = 0; i<t.parentNode.childNodes.length;i++) {
	    if (t.parentNode.childNodes[i].className == 'hover') {
	        t.parentNode.childNodes[i].className = '';
			t.childNodes[0].checked="checked";
		}
	}
	t.className = "hover";
	changePrice();
}

function changeAtt1(t) {
	t.lastChild.checked='checked';
	for (var i = 0; i<t.parentNode.childNodes.length;i++) {
	    if (t.className == 'hover') {
	           t.className = '';
			t.childNodes[0].checked = false;
		}
		else{
			t.className="hover";
			t.childNodes[0].checked = true;
		}
	}
	changePrice();
}

	function goods_cut(){
  		var num_val=document.getElementById('number');
  		var new_num=num_val.value;
  		var Num = parseInt(new_num);
  		if(Num>1)Num=Num-1;
  		num_val.value=Num;
  	}
  	function goods_add(){
  		var num_val=document.getElementById('number');
  		var new_num=num_val.value;
  		var Num = parseInt(new_num);
  		Num=Num+1;  num_val.value=Num;
  	}
</script>
			<!--
            <div class="is_scroll">
              <section id="search_ka">
                <div class="ui-sx bian1">
                  <div class="subNavBox" >
                    <div class="subNav" style=" border:0;"><a href="pocking.php?id=22" style=" border:0px;"><strong>自提点</strong></a></div>
                  </div>
                </div>
              </section>
            </div>
            -->
		</form>
	</div>
	<div class="main" id="user_goods_ka_2" style="display:none">
		<div class="product_main" style=" margin-top:40px;"> <!-- 产品图片 -->
			<div class="product_images product_desc" id="product_desc"> {$goods.goods_content|htmlspecialchars_decode} </div>
		</div>
		<section class="index_floor">
			<h2 style=" border-bottom:1px solid #ddd "> <span></span> 商品信息 </h2>
			<ul class="xiangq">
				<foreach name="goods_attr_list" item="v" key="k" >
					<li><p>{$goods_attribute[$v[attr_id]]}:</p><span>{$v[attr_value]}</span></li>
				</foreach>
				<li><p>上架时间：</p><span>{$goods.on_time|date='Y-m-d H:i',###}</span></li>
				<li></li>
			</ul>
		</section>
	</div>
	<div class="tab_attrs tab_item hide" id="user_goods_ka_3" style="display:none;">

		<div id="ECS_COMMENT">
			<link href="__STATIC__/css/photoswipe.css" rel="stylesheet" type="text/css">
			<script src="__STATIC__/js/klass.min.js"></script>
			<script src="__STATIC__/js/photoswipe.js"></script>
			<div class="comment_littlenav">
				<ul id="fy-comment-list">
					<li class="com-red" data-id="1">全部评论<br/>({$commentStatistics['c0']})</li>
					<li data-id="2">好评<br/>({$commentStatistics['c1']})</li>
					<li data-id="3">中评<br/>({$commentStatistics['c2']})</li>
					<li data-id="4">差评<br/>({$commentStatistics['c3']})</li>
					<li data-id="5">晒单<br/>({$commentStatistics['c4']})</li>
				</ul>
			</div>
			<div class="my_comment_list" id="ECS_MYCOMMENTS"> </div>

		</div>
	</div>
</div>
<script>
	function goTop(){
		$('html,body').animate({'scrollTop':0},600);
	}
</script>
<a href="javascript:goTop();" class="gotop"><img src="__STATIC__/images/topup.png"></a>
<div style=" height:60px;"></div>
<div class="footer_nav">
	<ul>
		<li class="bian"><a href="{:U('Index/index')}"><em class="goods_nav1"></em><span>首页</span></a> </li>
		<li class="bian"><a href="tel:{$tpshop_config['shop_info_phone']}"><em class="goods_nav2"></em><span>客服</span></a> </li>
		<li class="bian">
			<a href="javascript:void(0)"  onclick="getGoodsShare({$goods['goods_id']})" class="jiathis jiathis_txt" target="_blank">
				<em id="pro_share" class="goods_share"></em>
				<span>分享</span>
			</a>
			<script>
				var loading = $("#loadingToast");
				function getGoodsShare(goods_id) {
					loading.fadeIn(1000);
					$.ajax({
						url: "{:U('Api/goodsShare')}",
						type: 'post',
						data: {goods_id: goods_id},
						success: function (data) {
							loading.fadeOut();
							if (data.code == 200) {
								window.location.href = data.data.fullUrl;
							} else if (data.code == 403) {
								layer.open({
									content: '您未注册代理，请先绑定手机升级为代理',
									time: 1
								});
								window.location.href = "{:U('Mobile/User/distribute')}";
							} else {
								layer.open({content: "请求失败!" + data.message})
							}
						}
					})
				}
			</script>
		</li>
	</ul>
	<dl>
		<!--<dd class="flow"><a class="button active_button" href="javascript:void(0);" onClick="AjaxAddCart({$goods.goods_id},1,0);">加入购物车</a> </dd>-->
		<!--<dd class="goumai"><a style="display:block;" href="javascript:void(0);"  onclick="AjaxAddCart({$goods.goods_id},1,1);">立即购买</a> </dd>-->
		<if condition="$goods['store_count'] eq 0">
			<dd class="css-nobuy" style="width: 100%;">商品已售罄</dd>
			<else />
			<dd class="goumai ping-btn-wrapper" style=" width: 100%; display: flex; align-items: center;">
				<if condition="$group_order eq null">
					<div class="ping-btn" onclick="javascript:window.location.href='{:U('Cart/confirmOrder', ['goods_id' => $goods[goods_id]])}'">
						<span>单独购买</span>
						<span>¥{$group_buy_info['goods_price']}</span>
					</div>
					<div class="ping-btn" onclick="javascript:window.location.href='{:U('Cart/confirmOrder', ['goods_id' => $goods[goods_id], 'is_group' => 1])}'">
                    <span>
                        拼团购买
                    </span>
						<span>¥{$group_buy_info['price']}</span>
					</div>
				 <else />
					<div class="ping-btn" onclick="javascript:window.location.href='{:U('Cart/confirmOrder', ['goods_id' => $goods[goods_id], 'is_group' => 1])}'">
                    <span>
                        拼团购买
                    </span>
						<span>¥{$group_buy_info['price']}</span>
					</div>
                    <switch name="group_order.group_status">
                        <case value="2">
                            <div class="ping-btn"  style="background: grey">
                                <span>此拼团已失效</span>

                            </div>
                         </case>
                        <case value="1">
                            <div class="ping-btn" >
                            <span>
                                此拼团已完成
                                </span>
                            </div>
                        </case>

                        <default />
                        <div class="ping-btn" onclick="javascript:window.location.href='{:U('Cart/confirmOrder', ['goods_id' => $goods[goods_id], 'is_group' => 1, 'group_order_sn' => $group_order['group_order_sn']])}'">
                                    <span>
							参团购买
						</span>
                                <span>¥{$group_buy_info['price']}</span>
					   </div>
                </switch>
            </if>
			</dd>
		</if>
	</dl>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		// 更新商品价格
		get_goods_price();
	});


	function toPay(goods_id, is_group) {
		window.location.href = "{:U('Cart/confirmOrder', ['goods_id' => $goods[goods_id]])}";

	}


	function switch_spec(spec)
	{
		$(spec).siblings().removeClass('hover');
		$(spec).addClass('hover');
		$(spec).siblings().children('input').prop('checked',false);
		$(spec).children('input').prop('checked',true);
		//更新商品价格
		get_goods_price();
	}

	function get_goods_price()
	{
		var goods_price = {$goods.shop_price}; // 商品起始价
		var store_count = {$goods.store_count}; // 商品起始库存
		var spec_goods_price = {$spec_goods_price};  // 规格 对应 价格 库存表   //alert(spec_goods_price['28_100']['price']);
		// 如果有属性选择项
		if(spec_goods_price != null)
		{
			goods_spec_arr = new Array();
			$("input[name^='goods_spec']:checked").each(function(){
				goods_spec_arr.push($(this).val());
			});
			var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
			goods_price = spec_goods_price[spec_key]['price']; // 找到对应规格的价格
			store_count = spec_goods_price[spec_key]['store_count']; // 找到对应规格的库存
		}
		var goods_num = parseInt($("#goods_num").val());
		// 库存不足的情况
		if(goods_num > store_count)
		{
			goods_num = store_count;
			alert('库存仅剩 '+store_count+' 件');
			$("#goods_num").val(goods_num);
		}
		var flash_sale_price = parseFloat("{$goods['flash_sale']['price']}");
		(flash_sale_price > 0) && (goods_price = flash_sale_price);
		$("#goods_price").html('￥'+goods_price+'元'); // 变动价格显示

	}

	function sortNumber(a,b)
	{
		return a - b;
	}

	// 好评差评 切换
	$("#fy-comment-list").children().each(function(i,o){
		$(o).click(function(){
			$(o).siblings().removeClass('com-red');
			$(o).addClass('com-red');
			commentType = $(o).data('id');// 评价类型   好评 中评  差评
			ajaxComment(commentType,1);
		});
	});

	function ajaxComment(commentType,page){
		$.ajax({
			type : "GET",
			url:"/index.php?m=Mobile&c=goods&a=ajaxComment&goods_id={$goods['goods_id']}&commentType="+commentType+"&p="+page,//+tab,
			success: function(data){
				$(".my_comment_list").empty().append(data);
				var myPhotoSwipe = $("#gallery a").photoSwipe({
					enableMouseWheel: false,
					enableKeyboard: false,
					allowUserZoom: false,
					loop:false
				});
			}
		});
	}

	$(document).ready(function(){
		var cart_cn = getCookie('cn');
		if(cart_cn == ''){
			$.ajax({
				type : "GET",
				url:"/index.php?m=Home&c=Cart&a=header_cart_list",//+tab,
				success: function(data){
					cart_cn = getCookie('cn');
				}
			});
		}
		$('#tp_cart_info').html(cart_cn);
	});
</script>
<script src="__PUBLIC__/js/jqueryUrlGet.js"></script><!--获取get参数插件-->
<script> set_first_leader(); //设置推荐人 </script>
<!-- 微信浏览器 调用微信 分享js-->
<if condition="$signPackage neq null">
	<include file="Public/wx_share"/>
</if>
<!-- 微信浏览器 调用微信 分享js  end-->
</body>
</html>
